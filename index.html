<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BizAnalyzer Pro - AIé§†å‹•ãƒ“ã‚¸ãƒã‚¹ãƒ—ãƒ©ãƒ³åˆ†æ</title>
  <style>
    /* CSSã¯çœç•¥ï¼šã™ã§ã«ãƒ‡ã‚¶ã‚¤ãƒ³OKãªçŠ¶æ…‹ã¨ã—ã¦ç¶­æŒ */
  </style>
</head>
<body>
  <div class="container">
    <form id="analysisForm">
      <input type="text" id="appName" name="appName" placeholder="ã‚¢ãƒ—ãƒªå" required>
      <input type="text" id="industry" name="industry" placeholder="æ¥­ç•Œ" required>
      <textarea id="description" name="description" placeholder="æ¦‚è¦" required></textarea>
      <input type="text" id="revenueModel" name="revenueModel" placeholder="åç›Šãƒ¢ãƒ‡ãƒ«" required>
      <input type="text" id="timeframe" name="timeframe" placeholder="äº‹æ¥­æœŸé–“" required>
      <input type="number" id="budget" name="budget" placeholder="äºˆç®—" required>
      <button type="submit" id="analyzeButton"><span id="buttonText">é€ä¿¡</span></button>
    </form>
    <div id="errorMessage" class="error-message"></div>
    <div id="resultsSection" class="results-section">
      <div id="analysisResults"></div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      class BizAnalyzer {
        constructor() {
          this.form = document.getElementById('analysisForm');
          if (!this.form) {
            console.error('ãƒ•ã‚©ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'); return;
          }
          this.button = document.getElementById('analyzeButton');
          this.buttonText = document.getElementById('buttonText');
          this.resultsSection = document.getElementById('resultsSection');
          this.resultsContainer = document.getElementById('analysisResults');
          this.errorMessage = document.getElementById('errorMessage');

          this.form.addEventListener('submit', (e) => {
            e.preventDefault();
            this.analyzeBusinessPlan();
          });
        }

        async analyzeBusinessPlan() {
          const data = Object.fromEntries(new FormData(this.form).entries());
          this.setLoading(true);
          this.hideError();

          try {
            const res = await fetch('/api/analyze', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data)
            });
            const result = await res.json();
            if (!result.analysis) throw new Error('APIã‹ã‚‰ã®responseã«analysisãŒã‚ã‚Šã¾ã›ã‚“');
            this.displayResults(result.analysis, data);
          } catch (err) {
            this.showError('åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + err.message);
          } finally {
            this.setLoading(false);
          }
        }

        displayResults(analysis, data) {
          const sections = analysis.split(/(?=ã€[^ã€‘]+ã€‘)/).map(block => {
            const match = block.match(/ã€([^ã€‘]+)ã€‘([\s\S]*)/);
            return match ? { title: match[1], content: match[2].trim() } : null;
          }).filter(Boolean);
          this.resultsContainer.innerHTML = sections.map((s, i) => `
            <div class="result-card">
              <div class="result-title">${['ğŸ¯','ğŸ’¼','ğŸ“¢','ğŸ’°','âš ï¸','ğŸš€'][i] || 'ğŸ“Š'} ${s.title}</div>
              <div class="result-content">${s.content.replace(/\n/g, '<br>')}</div>
            </div>`).join('');
          this.resultsSection.classList.add('active');
          this.resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        setLoading(loading) {
          this.button.disabled = loading;
          this.buttonText.innerHTML = loading ? '<div class="loading"><div class="spinner"></div>AIåˆ†æä¸­...</div>' : 'ğŸ” AIåˆ†æã‚’é–‹å§‹';
        }

        showError(msg) {
          this.errorMessage.textContent = msg;
          this.errorMessage.classList.add('active');
          this.errorMessage.scrollIntoView({ behavior: 'smooth' });
        }

        hideError() {
          this.errorMessage.classList.remove('active');
        }
      }

      new BizAnalyzer();
    });
  </script>
</body>
</html>
